---
- name: add rpmfusion repos 
  dnf:
    name: "{{ item }}"
    state: latest
    disable_gpg_check: yes # not recommended
  loop:
    - http://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ ansible_distribution_major_version }}.noarch.rpm
    - http://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ ansible_distribution_major_version }}.noarch.rpm

- name: remove packages
  dnf:
    name: "{{ item }}"
    state: absent
  loop: "{{ remove_packages }}"

- name: patch system
  dnf:
    update_cache: yes
    name: "*"
    state: latest
  when: patch 

- name: install packages
  dnf:
    name: "{{ item }}"
    state: latest
  loop: "{{ install_packages }}"
  when: install

- name: gather package facts
  package_facts:
    manager: auto

- name: download and install mullvad rpm
  block:
    - name: download package
      get_url:
        url: https://mullvad.net/download/app/rpm/latest
        dest: "/tmp"
      register: res

    - name: install package
      dnf:
        name: "{{ res.dest }}"
        disable_gpg_check: yes

    - name: remove package
      file:
        path: reg.dest
        state: absent
  when: "'mullvad-vpn' not in ansible_facts.packages"
